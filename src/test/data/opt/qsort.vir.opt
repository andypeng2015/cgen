module qsort

function $swap(l %a, l %b) {
@2:
  %x.1 = ld.w %a ; @3
  %y.1 = ld.w %b ; @4
  st.w %x.1, %b ; @5
  st.w %y.1, %a ; @6
  ret
}

function l $partition(l %arr, l %low, l %high) {
@7:
  %3 = lsl.l %high, 0x2_l ; @49
  %4 = add.l %arr, %3 ; @50
  %pivot.1 = ld.w %4 ; @11
  %6 = sub.l %low, 0x1_l ; @52
  %5 = sub.l %high, 0x1_l ; @51
  jmp @8(%low, %6)
@8(%j.2, %i.2):
  %7 = sle.l %j.2, %5 ; @53
  br %7, @14, @15
@14:
  %11 = lsl.l %j.2, 0x2_l ; @57
  %12 = add.l %arr, %11 ; @58
  %j_val.1 = ld.w %12 ; @22
  %13 = sle.w %j_val.1, %pivot.1 ; @59
  br %13, @18, @19(%i.2)
@19(%i.3):
  %14 = add.l %j.2, 0x1_l ; @60
  jmp @8(%14, %i.3)
@18:
  %15 = add.l %i.2, 0x1_l ; @61
  %16 = lsl.l %15, 0x2_l ; @62
  %17 = add.l %arr, %16 ; @63
  call $swap(%17, %12) ; @30
  jmp @19(%15)
@15:
  %8 = add.l %i.2, 0x1_l ; @54
  %9 = lsl.l %8, 0x2_l ; @55
  %10 = add.l %arr, %9 ; @56
  call $swap(%10, %4) ; @36
  ret %8
}

export function $qsort(l %arr, l %low, l %high) {
@48:
  jmp @38(%low)
@38(%1):
  %18 = slt.l %1, %high ; @64
  br %18, @39, @47
@39:
  %p.1 = call.l $partition(%arr, %1, %high) ; @42
  %19 = sub.l %p.1, 0x1_l ; @65
  call $qsort(%arr, %1, %19) ; @44
  %20 = add.l %p.1, 0x1_l ; @66
  jmp @38(%20)
@47:
  ret
}
