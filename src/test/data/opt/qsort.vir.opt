module qsort

function $swap(l %a, l %b) {
@2:
  %x.1 = ld.w %a ; @3
  %y.1 = ld.w %b ; @4
  st.w %x.1, %b ; @5
  st.w %y.1, %a ; @6
  ret
}

function l $partition(l %arr, l %low, l %high) {
@7:
  %21 = lsl.l %high, 0x2_l ; @67
  %22 = add.l %arr, %21 ; @68
  %pivot.1 = ld.w %22 ; @11
  %23 = sub.l %high, 0x1_l ; @69
  %24 = sub.l %low, 0x1_l ; @70
  jmp @8(%low, %24)
@8(%j.2, %i.2):
  %25 = sle.l %j.2, %23 ; @71
  br %25, @14, @15
@14:
  %29 = lsl.l %j.2, 0x2_l ; @75
  %30 = add.l %arr, %29 ; @76
  %j_val.1 = ld.w %30 ; @22
  %31 = sle.w %j_val.1, %pivot.1 ; @77
  br %31, @18, @19(%i.2)
@19(%i.3):
  %32 = add.l %j.2, 0x1_l ; @78
  jmp @8(%32, %i.3)
@18:
  %33 = add.l %i.2, 0x1_l ; @79
  %34 = lsl.l %33, 0x2_l ; @80
  %35 = add.l %arr, %34 ; @81
  call $swap(%35, %30) ; @30
  jmp @19(%33)
@15:
  %26 = add.l %i.2, 0x1_l ; @72
  %27 = lsl.l %26, 0x2_l ; @73
  %28 = add.l %arr, %27 ; @74
  call $swap(%28, %22) ; @36
  ret %26
}

export function $qsort(l %arr, l %low, l %high) {
@48:
  jmp @38(%low)
@38(%1):
  %36 = slt.l %1, %high ; @82
  br %36, @39, @47
@39:
  %p.1 = call.l $partition(%arr, %1, %high) ; @42
  %37 = sub.l %p.1, 0x1_l ; @83
  call $qsort(%arr, %1, %37) ; @44
  %38 = add.l %p.1, 0x1_l ; @84
  jmp @38(%38)
@47:
  ret
}
